import numpy as np
from scipy.interpolate import UnivariateSpline
import matplotlib.pyplot as plt

# Dados pré-definidos como arrays numpy
X_DATA = np.array([
    1.2077226551344623e-7, 1.4585940117250354e-7, 1.7895022156272113e-7,
    2.1954828787123655e-7, 2.6101572156825384e-7, 3.202318179734705e-7,
    4.0543710976836477e-7, 4.820145070719145e-7, 5.64113015651022e-7,
    6.498925074488289e-7, 7.973322752256328e-7, 9.93728532163703e-7,
    1.2191736670684703e-6, 1.4957650730192784e-6, 1.7505293589026523e-6,
    2.0811625914767567e-6, 2.435633966018562e-6, 2.8956671139669238e-6,
    3.4971627752656786e-6, 4.22360271238127e-6, 4.865847234617288e-6,
    5.876593941670659e-6, 6.8775173393231e-6, 7.92331831506712e-6,
    9.272847441516206e-6, 1.1199027932724732e-5, 1.33142571279698e-5,
    1.633483507981373e-5, 1.9727950393776196e-5, 2.420358965939684e-5,
    2.9231223567231827e-5, 3.4752304314023046e-5, 4.06714463979415e-5,
    4.8353312301890406e-5, 5.7486099404679175e-5, 6.622748323302575e-5,
    7.629808911723947e-5, 8.517808440132827e-5, 9.813033437525335e-5,
    0.00011305211419439773, 0.00012821047148237337, 0.0001454013055383183,
    0.00016489713677680354, 0.0001870070259446334, 0.0002120814735551935,
    0.00023676469310632658, 0.0002643206828112887, 0.00029508379161267354,
    0.00032942728183960697, 0.0003563793802936025, 0.00039785679149705895,
    0.00043040745140336385, 0.0004656212440825166, 0.0005117011505108638,
    0.0005535659885126732, 0.0006179930721303395, 0.0006791523583507204,
    0.0007463642339279569, 0.000820227689468164, 0.0009156903425781838,
    0.001006311047366872, 0.0011412401683967913, 0.00129426097961489,
    0.0014677992676220704, 0.0016646060755636306, 0.0019177274523866814,
    0.0022093386751530796, 0.0025856414783156983, 0.0030740074665268945,
    0.003712548459377023, 0.004413760291083362, 0.005084920332036381,
    0.005858137524004617
])

Y_DATA = np.array([
    0.002325581395348837, 0.002325581395348837, 0.004651162790697674,
    0.004651162790697674, 0.0069767441860465115, 0.0069767441860465115,
    0.009302325581395349, 0.011627906976744186, 0.011627906976744186,
    0.01627906976744186, 0.018604651162790697, 0.023255813953488372,
    0.030232558139534883, 0.03953488372093023, 0.046511627906976744,
    0.053488372093023255, 0.06279069767441861, 0.06744186046511627,
    0.07209302325581396, 0.08372093023255814, 0.09302325581395349,
    0.10697674418604651, 0.11627906976744186, 0.12790697674418605,
    0.14186046511627906, 0.15348837209302324, 0.16511627906976745,
    0.17674418604651163, 0.18372093023255814, 0.19534883720930232,
    0.20465116279069767, 0.21395348837209302, 0.22790697674418603,
    0.2441860465116279, 0.26046511627906976, 0.2744186046511628,
    0.29069767441860467, 0.30930232558139537, 0.32790697674418606,
    0.3441860465116279, 0.3627906976744186, 0.38372093023255816,
    0.4046511627906977, 0.4255813953488372, 0.4511627906976744,
    0.4744186046511628, 0.49534883720930234, 0.5209302325581395,
    0.541860465116279, 0.5604651162790698, 0.5837209302325581,
    0.6046511627906976, 0.6255813953488372, 0.6441860465116279,
    0.6674418604651162, 0.6930232558139535, 0.7186046511627907,
    0.7395348837209302, 0.7651162790697674, 0.7883720930232558,
    0.8093023255813954, 0.8302325581395349, 0.8488372093023255,
    0.872093023255814, 0.8930232558139535, 0.9093023255813953,
    0.9232558139534883, 0.9418604651162791, 0.9558139534883721,
    0.9674418604651163, 0.9744186046511628, 0.9837209302325581,
    0.9906976744186047
])

# Pré-processamento crítico
sorted_indices = np.argsort(X_DATA)
X_DATA = X_DATA[sorted_indices]
Y_DATA = Y_DATA[sorted_indices]

# Remove pontos duplicados
unique_mask = np.append(True, np.diff(X_DATA) > 1e-20)
X_UNIQUE = X_DATA[unique_mask]
Y_UNIQUE = Y_DATA[unique_mask]

# Criação do spline em espaço logarítmico
log_x = np.log(X_UNIQUE)
spline = UnivariateSpline(log_x, Y_UNIQUE, k=3, s=0.0001)

def compute_Hl_psi(x):
    if x < X_UNIQUE[0]:
        return 0.0
    if x > X_UNIQUE[-1]:
        return 1.0
    return spline(np.log(x))

# Geração dos dados para plotagem
x_values = np.logspace(np.log10(1e-7), np.log10(1e-2), 1000)
hl_psi_values = [compute_Hl_psi(x) for x in x_values]

# Plotagem com verificação de limites
plt.figure(figsize=(10, 6))
plt.plot(x_values, hl_psi_values, label='Spline Otimizado', color='navy')
plt.scatter(X_UNIQUE, Y_UNIQUE, color='red', s=40, label='Dados Originais')
plt.xscale('log')
plt.xticks([1e-7, 1e-6, 1e-5, 1e-4, 1e-3, 1e-2], 
           ['$10^{-7}$', '$10^{-6}$', '$10^{-5}$', '$10^{-4}$', '$10^{-3}$', '$10^{-2}$'])
plt.xlabel('x (Escala Logarítmica)')
plt.ylabel('H/ψ')
plt.title('Interpolação Spline Corrigida')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.show()